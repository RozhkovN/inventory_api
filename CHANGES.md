# üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ Inventory API

## üîÑ –í–µ—Ä—Å–∏—è 1.1 - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö

### ‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 1. **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `coefficient` –≤ –º–æ–¥–µ–ª—å `SaleItem`
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–¥–∞–∂–∏ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —É–∫–∞–∑–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–ù–î–°, –Ω–∞–ª–∏—á–∫–∞ –∏ —Ç.–¥.)
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ –¥–µ—Ñ–æ–ª—Ç—É = 1.0
- –†–∞—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Ü–µ–Ω—ã: `final_sell_price = sold_price_per_unit √ó coefficient`

#### 2. **–ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ –ø–æ–ª–µ `final_price` –≤ `ProductResponse`
- –§–æ—Ä–º—É–ª–∞: `final_price = purchase_price √ó coefficient`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞ —Å —É—á—ë—Ç–æ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ (–ù–î–°, –∫–æ–º–∏—Å—Å–∏–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –∏ —Ç.–¥.)

#### 3. **–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ —Å–∫–ª–∞–¥–æ–º** üìä
- –ù–æ–≤—ã–π endpoint: `GET /stock-history`
- –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:
  - `product_id` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–æ–≤–∞—Ä—É
  - `operation_type` ‚Äî —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (INCOMING, SALE, ADJUSTMENT)
  - `days` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)

### üìã –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### Models (`app/models/`)
- **sale.py**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `coefficient` –≤ `SaleItem`

#### Schemas (`app/schemas/`)
- **product.py**: –î–æ–±–∞–≤–ª–µ–Ω–æ `computed_field final_price`
- **sale.py**: 
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `coefficient` –≤ `SaleItemCreate`
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `coefficient` –≤ `SaleItemResponse`
  - –î–æ–±–∞–≤–ª–µ–Ω–æ `computed_field final_sell_price` –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∏—Ç–æ–≥–æ–≤–æ–π —Ü–µ–Ω—ã
- **stock_operation.py**: –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å—Ö–µ–º–∞ `StockOperationResponse` –¥–ª—è API

#### Routes (`app/routes/`)
- **products.py**:
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
  - –ù–æ–≤—ã–π endpoint `GET /stock-history` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- **sales.py**:
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `create_sale` –¥–ª—è —É—á—ë—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ
  - –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `coefficient`
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `get_all_sales` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ `coefficient`

#### Tests
- **test_api_full.py**: –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Ç–µ—Å—Ç

### üî¢ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç < 1):
```json
{
  "name": "–ö–ê–†–¢–†–ò–î–ñ –ß–Å–†–ù–´–ô",
  "sku": "C60-BLK",
  "purchase_price": "3000.00",
  "coefficient": "0.9",  // -10% —Å–∫–∏–¥–∫–∞
  "quantity": 5
}
// –ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞: 3000 √ó 0.9 = 2700
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å –ù–î–° (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç > 1):
```json
{
  "name": "–¢–û–ù–ï–† –°–ò–ù–ò–ô",
  "sku": "C60-CYN",
  "purchase_price": "3000.00",
  "coefficient": "1.18",  // +18% –ù–î–°
  "quantity": 10
}
// –ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞: 3000 √ó 1.18 = 3540
```

#### –ü—Ä–æ–¥–∞–∂–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏:
```json
{
  "client_name": "–û–û–û –¢–µ—Å—Ç",
  "items": [
    {
      "product_id": 1,
      "quantity": 2,
      "sold_price_per_unit": "3800.00",
      "coefficient": "1.0"  // –±–µ–∑ –ù–î–° (–æ–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π)
    },
    {
      "product_id": 2,
      "quantity": 3,
      "sold_price_per_unit": "3950.00",
      "coefficient": "1.2"  // –Ω–∞–ª–∏—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç
    }
  ]
}
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏:
```bash
# –ò—Å—Ç–æ—Ä–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
GET /api/stock-history?days=7

# –ò—Å—Ç–æ—Ä–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É
GET /api/stock-history?product_id=1

# –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂
GET /api/stock-history?operation_type=SALE

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
GET /api/stock-history?product_id=1&operation_type=INCOMING&days=30
```

### üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

- ‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ (—Å–∫–∏–¥–∫–∏, –ù–î–° –∏ —Ç.–¥.)
- ‚úÖ –ì–∏–±–∫–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ (—Ä–∞–∑–Ω—ã–µ –ø–æ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–∞—Ç–∞–º–∏ –∏ –¥–µ—Ç–∞–ª—è–º–∏
- ‚úÖ –õ–µ–≥–∫–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
